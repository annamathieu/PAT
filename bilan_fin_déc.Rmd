---
title: "Bilan fin décembre - Projet PAT"
author: "Erwan Gouhier, Anna Mathieu"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    number_sections: true
    toc_float: true
    self_contained: true
    df_print: paged
    highlight: tango
    tabset: true
  pdf_document:
    toc: true
    toc_depth: '3'
editor_options:
  markdown:
    wrap: 80
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)

```

```{r}
# packages à charger
library(purrr)
library(easyCODA)    # Greenacre 
library(FactoMineR)

library(tidyverse)
library(dplyr)

library(Factoshiny)
library(ggplot2)
library(ggrepel)
library(RColorBrewer)
library(plotly)
library(tidyr)

```

```{r}
# chargement des données des autres RMD

load(file = "data/clust.RData")     # coordonnéees des mots = formes fortes 
load(file = "data/documents.RData") # comptage des lemmes dans les doc
load(file = "data/vocab.RData")     # identification des mots 
load(file = "data/mfa.df.final.RData")
load(file = "data/res.lemmat.RData")
load(file = "data/res.hcpc.RData")
load(file = "data/clust.RData")
load(file = "data/res.mfa.RData")

```

# Objectifs 

A partir des formes fortes obtenues par MFA, on souhaite extraire les compositions des descriptions des PAT. On va comparer différentes procédures pour aboutir à la classification des PAT, en commençant par la caractérisation de nos PAT à travers la fréquence d'apparition de chaque terme de chaque topic dans les descriptions des PAT tokenisées.

# Formes Fortes 

Voici les formes fortes identifiées (voir doc 12.12) :

```{r}
source(file = "functions/plot_clust.R")

plot_clust(res.hcpc, res.mfa, mfa.df.final)
```

Les formes fortes ne sont pas toutes composées du mêmes nombre de mots :

```{r}
clust %>% 
  group_by(clust) %>% 
  summarise(sum = n())
```

Cela caractérise le fait que certains thèmes sont bcp plus riches en mots. Faut il considérer le même nombre de mots par thème ? 

En effet, le thème 3 , qui a le plus de mots, a peut-être plus de chances d'être un thème que l'on retrouve plus au niveau fréquence dans les PAT (ce que l'on ne confirme pas à posteriori ). 
On prend note de cela mais pour l'instant on va conserver l'ensemble des termes composant nos topics fortifiés. 


## Association des formes fortes - axes thématiques
```{r}
# à faire 
# + description des PAT (à demander)
```


# Construction des df

On va "reconstituer" dans df_textes chaque description de PAT à travers les tokens de ces descriptions.
```{r}
df_textes <- imap_dfr(documents, function(mat, nom_doc) {
  
  # index des mots
  idx <- mat[1, ]
  
  # fréquences
  freq <- mat[2, ]
  
  # conversion index -> mots
  mots <- vocab[idx]
  
  # répéter les mots selon la fréquence
  texte <- paste(
    rep(mots, times = freq),
    collapse = " "
  )
  
  tibble(
    doc = nom_doc,
    texte = texte
  )
})

df_textes

# save(df_textes, file = "data/df_textes.RData")

```



On crée le data frame "df_resultat.final" qui correspond à la table de comptage des termes de nos topics fortifiés (par topic) par PAT.
```{r}
df_mots <- tibble(mot = rownames(mfa.df.final)) # une colonne pour les mots 

df_cross <- crossing(df_mots, df_textes) # tous les croisement des mots (132) avec tous les textes (360)

df_count <- df_cross %>%  mutate(occurrence = str_count(texte, fixed(mot)))  # comptage des occurences de chaque mot dans le texte 

df_resultat <- df_count %>%          # df avec autant de lignes que de mots, et de colonnes que de PAT et au croisement les occurences des mots (issus des formes fortes)
  select(mot, doc, occurrence) %>%
  pivot_wider(
    names_from = doc,
    values_from = occurrence
  )

rm(df_mots)
rm(df_cross)
rm(df_count)

# on trie les mots (lignes) du doc clust par ordre alphabétique pour ensuite récupérer les clusters des mots 
clust <- clust %>% arrange(by = word) # ⚠ important avant le merge de la colonnes clust !!
  
df_resultat$cluster <- clust$clust

df_resultat.final <- data.frame(df_resultat %>%
  group_by(cluster) %>%
  summarise(across(where(is.numeric), sum, na.rm = TRUE)))


# sum(is.na(df))
# 
# max.col(df)
# 
# colnames(df)[max.col(df)]
# 
# 
# 
# summary(colSums(df_resultat.final[,-1]))

df_resultat.final <- df_resultat.final[,-1]

head(df_resultat.final)

```

# Filtrage PAT nb termes FF

Filtre pour supp les docs qui ont pas assez de mots qui se retrouvent 

On veut filtrer les PAT qui n'ont pas assez de mots issus de nos formes fortes, ou placer la limite ? 
On trace l'histogramme du nombre total de termes issus de l'ensemble de nos topics (formes fortes). On avait fixé la limite à 10 termes minimum issus des formes fortes pour que le PAT soit conservé pour la classification 

```{r}
hist(colSums(df_resultat.final), breaks = 200, xlim = range(0:150), main = "", xlab = "", ylab = "")
abline(v = 10, col = "blue4", lwd = 3)
title(main = "Histogramme du nombre total de termes issus des formes fortes par description de PAT", cex.main = 0.9, 
      xlab = "Nombre de termes total (< 150)", 
      ylab = "Effectifs")
```

On va créer le data frame filtré contenant uniquement les PAT avec plus de 10 termes issus des formes fortes. 
```{r}
df_filtre <- as.data.frame(df_resultat.final[, colSums(df_resultat.final) >= 10])
```


# Table de Fréquence
On va créer le tableau contenant les fréquences de chaque topic à partir de nos comptages.
```{r}
df <- data.frame(apply(df_filtre,2,function(x) x/sum(x)*100))
df[df=="NaN"] <- 0
```

On va transposer le df pour obtenir un tableau de données avec 6 colonnes (les titres sont issus des noms extraits par extraction des variables latentes avec NailR) et autant de lignes que de PAT après sélection (PAT ayant une description + au moins un certain nb de caractères dans la description et au moins 10 termes issus de nos formes fortes)
```{r}
df <- data.frame(t(df))
colnames(df) <- c("Gouvernance", "Education/Justice Sociale", "Territoires" , "Environnement","Secteur agricole", "Economie alimentaire")
rownames(df) <- as.numeric(gsub("text", "", rownames(df)))

df <- df[order(as.numeric(rownames(df))), ]

# NB : les noms des ROWS correspondent aux n° des PAT (ayant une description + n'ayant pas été supp par les filtrages)
head(df)

```


# PAT Purs 

Comment se répartissent les vecteurs de composition des PAT en 6 topics ? 

```{r}
summary(df)
```


```{r}

plot <- df %>%
  pivot_longer(cols = everything(),
               names_to = "Groupe",
               values_to = "Valeur") %>%
  ggplot(aes(x = Groupe, y = Valeur, fill = Groupe)) +

  geom_boxplot() +

  scale_fill_manual(values = c("gold1", "tomato2", "springgreen4", "royalblue", "chartreuse2", "saddlebrown")) +
  theme_minimal() +
  labs(title = "Distribution par groupe",
       x = "Groupe",
       y = "Valeur") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        title = element_text(hjust = 0.5))

plot + ylim(0, 50)

# from gemini request 
# 12.12.25 Rmd
```

On veut classifier nos PAT selon ces vecteurs de proportion de nos 6 topics. 

⚠️ Ces vecteurs de proportions sont construits sur l'occurence des mots représentatifs de chaque topic dans chacun des PAT. Ces mots sont les termes ayant les indices frex les plus forts, consolidés par de nombreuses éxecutions de la LDA, puis filtrés pour supprimer les mots n'apparaissant que dans un seul topic d'une seule LDA, puis regroupés dans des formes fortes par classification hiérarchique précédée d'une MFA. 


On s'intéresse aux PAT qui sont les plus purs, c'est à dire qui prennent la valeur maximale pour un des topics. On va essayer de comprendre la solidité de notre mesure de fréquence en comparant ces PAT avec leur description. 

On pourrait utiliser ces PAT comme exemple pour fournir à un modèle de langage de l'information supplémentaire liée à chaque topic pour en extraire le nom de la variable latente ensuite. 

```{r}
df.t = data.frame(t(df)) 
colnames(df.t) <- gsub("X","PAT n°",colnames(df.t))
df.t[,max.col(df.t)] 
# on cherche les textes les plus purs de chaque topic et on affiche leur profils de répartition des topics 
```

Analyse de ces PAT "purs" 
=> qualitative : à la main, en comparant avec la base

## PAT 211 - Gouvernance

```{r}
df_textes$texte[159]
```
"Caux Seine agglo est engagée dans divers programmes pour répondre aux problématiques et enjeux du territoire. Ainsi, le Projet Alimentaire Territorial vient renforcer les actions du Plan Climat Air Energie Territorial, du Plan Local des Déchets Ménagers et Assimilés, du Plan Local d'Urbanisme Intercommunal, du programme d'actions de la Protection de la Ressource en Eau et du Contrat Local de Santé."

On retrouve des mots du vocabulaire de la gouvernance : plan, action, renforcer, enjeu, programme, problématique, contrat
Environnement : climat, eau, déchet (eau et déchet ne sont pas dans le mots reconnu)
Stats Agriculture : an (mais c'est pas clair)


```{r}
# cat(gemini_generate(nail_textual(dataset = df_textes[159,], num.var = 1, num.text = 2,
#                   introduction = "Ces mots sont des termes issus de la description d'un PAT.",
#                   request = "Quel est le thème principal abordé dans ce texte ? Quels sont les autres thèmes abordés ? peux tu quantifier cette répartition entre thèmes?",
#                   isolate.groups = F, drop.negative = T, generate = F)))
```

Voici l'analyse des données fournies, structurée selon les thèmes abordés et leur répartition.

Analyse du Groupe 'text211'

Le groupe 'text211' présente un ensemble de termes qui s'articulent autour de l'élaboration et la mise en œuvre de stratégies et d'actions à l'échelle d'un territoire, en lien avec des problématiques de développement durable.

Thème principal abordé

Le thème principal est l'**Action et la Planification Territoriale**. Ce thème est fortement représenté par des mots décrivant la mise en œuvre, la gestion et le cadre géographique et institutionnel des initiatives. Des termes comme `action` (x2), `programme` (x2), `local` (x3), `territorial` (x2), `intercommunal`, `agglo`, `contrat`, `engager`, `renforcer`, `répondre` et `venir` soulignent l'importance de la structuration et de la concrétisation des efforts à une échelle locale et régionale.

Autres thèmes abordés

D'autres thèmes majeurs se dégagent, représentant les domaines d'application ou les objectifs de cette planification territoriale :

1.  **Environnement et Gestion des Ressources Naturelles et Déchets** : Ce thème regroupe des préoccupations écologiques et de gestion des ressources. On y trouve `climat`, `déchet`, `eau`, `énergie`, `protection`, `ressource`, ainsi que des termes liés à la gestion des déchets comme `ménager` et `assimilé` (souvent dans le contexte de "déchets ménagers et assimilés").
2.  **Enjeux Socio-urbains et Alimentaires** : Ce thème fait référence aux dimensions sociales, sanitaires et d'aménagement de l'espace. Les mots `alimentaire`, `santé` et `urbanisme` en sont les principaux indicateurs.
3.  **Défis et Problématiques Générales** : Des termes plus génériques soulignent la nature complexe et les enjeux sous-jacents aux actions menées. Il s'agit de `enjeu` et `problématique`.

Répartition quantifiée entre les thèmes

Sur un total de 29 mots, la répartition est la suivante :

*   **Action et Planification Territoriale** : 16 mots (environ 55.2%)
    *   `action` (2), `agglo`, `contrat`, `engager`, `intercommunal`, `local` (3), `programme` (2), `renforcer`, `répondre`, `territorial` (2), `venir`
*   **Environnement et Gestion des Ressources Naturelles et Déchets** : 8 mots (environ 27.6%)
    *   `assimilé`, `climat`, `déchet`, `eau`, `énergie`, `ménager`, `protection`, `ressource`
*   **Enjeux Socio-urbains et Alimentaires** : 3 mots (environ 10.3%)
    *   `alimentaire`, `santé`, `urbanisme`
*   **Défis et Problématiques Générales** : 2 mots (environ 6.9%)
    *   `enjeu`, `problématique`

---Final Summary Task


1. Comparison of all groups

Seul le groupe 'text211' a été fourni pour analyse. Par conséquent, une comparaison entre plusieurs groupes n'est pas possible.

2. List of group names you assigned

*   **Group 'text211'**: Planification et Action Territoriale pour le Développement Durable


---------------

C'est très convaincant 55 % de 'gouvernance et planification territoriale' pour notre PAT caractérisé par 60 % de topic gouvernance.


## PAT 100 - Education / Justice sociale
```{r}
df_textes$texte[81]
```

ce PAT reflète bien un pat abordant le sujet regroupant de la justice sociale - education alimentaire - la  restauration collective sous l'angle de : précarité, sain, sensibilisation, collectif , durable , etc. 

C'est plutôt convaincant pour un PAT caractéristique de ce topic

```{r}
# cat(gemini_generate(nail_textual(dataset = df_textes[81,], num.var = 1, num.text = 2,
#                   introduction = "Ces mots sont des termes issus de la description d'un PAT.",
#                   request = "Quel est le thème principal abordé dans ce texte ? Quels sont les autres thèmes abordés ? peux tu quantifier cette répartition entre thèmes?",
#                   isolate.groups = F, drop.negative = T, generate = F)))
```

Voici l'analyse du groupe 'text100' :

Analyse du Groupe 'text100'

Le texte fourni décrit un ensemble de termes relatifs à un Projet Alimentaire Territorial (PAT). L'analyse des mots clés permet de dégager les thèmes principaux et secondaires.

Thème Principal Abordé

Le thème principal abordé est le **développement et la mise en œuvre d'un Projet Alimentaire Territorial (PAT) visant à créer un système alimentaire local, durable, sain et solidaire.**

Ce thème englobe les objectifs généraux du projet ainsi que les caractéristiques clés du système alimentaire visé, qui sont fortement représentées par les mots utilisés.

Autres Thèmes Abordés et leur Répartition Quantifiée

Les mots ont été classés en différentes catégories thématiques pour quantifier leur répartition. Sur un total de **32 mots** analysés, la distribution est la suivante :

1.  **Actions, Objectifs & Mise en Œuvre du PAT**
    *   Mots : `action`, `créer`, `favoriser` (2), `objectif`, `renforcer`, `sensibilisation`, `travailler`, `valoriser`
    *   Nombre de mots : **9**
    *   Répartition : **28.13%**
    *   *Ce thème regroupe les verbes d'action et les noms d'objectifs, soulignant la dimension proactive et la volonté de concrétisation du projet.*

2.  **Système Alimentaire & Qualité**
    *   Mots : `alimentaire`, `alimentation` (2), `produit`, `restauration`, `sain` (2), `vente`
    *   Nombre de mots : **8**
    *   Répartition : **25.00%**
    *   *Ce thème se concentre sur l'objet même du projet : l'alimentation, sa qualité (sain) et les activités connexes (produit, restauration, vente).*

3.  **Développement Durable & Ancrage Territorial**
    *   Mots : `circuit`, `court`, `durable` (2), `local` (2)
    *   Nombre de mots : **6**
    *   Répartition : **18.75%**
    *   *Ce thème met en évidence l'importance de la durabilité, de la proximité (local, circuit court) et de l'ancrage géographique du système alimentaire.*

4.  **Dimension Sociale & Collective**
    *   Mots : `association`, `collectif` (2), `précarité`
    *   Nombre de mots : **5**
    *   Répartition : **15.63%**
    *   *Ce thème souligne l'aspect communautaire, collaboratif (collectif, association) et l'attention portée aux vulnérabilités sociales (précarité) dans le cadre du PAT.*

5.  **Le Projet Alimentaire Territorial (PAT) - Cadre Général**
    *   Mots : `pat`
    *   Nombre de mots : **1**
    *   Répartition : **3.13%**
    *   *Ce mot identifie directement le type de projet en question.*

6.  **Termes Génériques / Descriptifs**
    *   Mots : `introduction`, `nombre`, `point`
    *   Nombre de mots : **3**
    *   Répartition : **9.38%**
    *   *Ces mots sont plus génériques et servent à structurer ou introduire des éléments de description.*

---

"Le développement et la mise en œuvre d'un Projet Alimentaire Territorial (PAT) visant à créer un système alimentaire local, durable, sain et solidaire" => le thème principal identifié est donc lié une alimentation, saine, durabke et à la notion de solidarité, bien que la robustesse de la réponse soit plus faible, aussi certainement lié au fait que cette thématique 'alimentation durable, justice sociale, etc" soit assez multiTématique et que l'analyse par le LLM est complétement sans a priori de nos topics.


## PAT 300 mix Territoires / Education_Justice Sociale 
```{r}
df_textes$texte[232]
```

Ce profil de PAT semble assez bien refléter les 2 thématiques principales qui sont sensées le composee

avec LLM : 
```{r}
# cat(gemini_generate(nail_textual(dataset = df_textes[232,], num.var = 1, num.text = 2,
#                   introduction = "Ces mots sont des termes issus de la description d'un PAT.",
#                   request = "Quel est le thème principal abordé dans ce texte ? Quels sont les autres thèmes abordés ? peux tu quantifier cette répartition entre thèmes?",
#                   isolate.groups = F, drop.negative = T, generate = F)))
```

Analyse du groupe 'text300'

Le groupe 'text300' est représenté par une seule réponse, décrivant un ensemble de termes liés à un PAT (Projet Alimentaire Territorial).

Thème principal

Le thème principal abordé dans ce texte est le **développement de systèmes alimentaires territoriaux, durables et inclusifs, avec un accent fort sur l'accès et l'approvisionnement local et collectif, notamment pour les populations défavorisées en milieu urbain.**

Plus précisément, les termes indiquent une préoccupation pour la structuration de l'approvisionnement et de la distribution alimentaire (circuits courts, chaine, centrale, approvisionnement, restauration), la valorisation des produits locaux et du goût, ainsi que l'intégration des dimensions sociales et environnementales (durable, circulaire, collectif, défavorisé, quartier, qpv, économie sociale).

Autres thèmes abordés

1.  **Logistique et organisation de la chaîne alimentaire :** Accès, approvisionnement, centrale, chaine, circuit (court, circulaire), dispositif, regrouper.
2.  **Inclusion sociale et territoriale :** Acteur, collectif, défavorisé, enjeu, favoriser, qpv (Quartiers Prioritaires de la Ville), quartier, urbain, éducation.
3.  **Durabilité et modèles économiques :** Circulaire, commerce, durable, économie, enjeu.
4.  **Qualité et valorisation du produit :** Goût, produit, alimentation, cuisine, restauration.

Quantification de la répartition entre thèmes

Étant donné la nature qualitative des données et la présence d'une seule réponse, une quantification numérique stricte n'est pas possible. Cependant, nous pouvons évaluer la prépondérance des thèmes par le nombre de mots-clés qui s'y rapportent directement :

*   **Système Alimentaire Local et Approvisionnement (35%)** : alimentation, approvisionnement, circuit (court, circulaire), chaine, centrale, cuisine, goût, produit, restauration, accès.
*   **Inclusion Sociale et Territoriale (30%)** : acteur, collectif, défavorisé, enjeu, favoriser, qpv, quartier, urbain, éducation.
*   **Durabilité et Économie (20%)** : circulaire, commerce, durable, économie.
*   **Organisation et Dispositifs (15%)** : dispositif, regrouper.

Le thème du **système alimentaire** est clairement central et omniprésent, mais il est intrinsèquement lié et qualifié par des préoccupations d'**inclusion sociale** et de **durabilité**, qui représentent ensemble une part très significative du vocabulaire. L'accent est mis sur une approche holistique de l'alimentation, ne se limitant pas à l'acte de manger, mais englobant toute sa chaîne de valeur et son impact social et environnemental.

---


## PAT 331 - Environnement 57 % (avec agri 37 %)
```{r}
df_textes$texte[250]
```
Environnement : biodiversite, changement, climatique, eau, environnement, fort, protection, ressource, usage
Secteur agricole: activité, agricole, agriculture, an, exploitant
Gouvernance : santé (pas clair)

Petite observation "d'incohérence dans les thèmes" : métropole & ménage dans Stats agri

Le texte en lui même parle du conflit entre l'utilisation des terres pour l'agriculture et des protections environnementales, mais plus des contraintes en eau du territoire pour l'agriculture.

et avec LLM 
```{r}
# cat(gemini_generate(nail_textual(dataset = df_textes[250,], num.var = 1, num.text = 2,
#                   introduction = "Ces mots sont des termes issus de la description d'un PAT.",
#                   request = "Quel est le thème principal abordé dans ce texte ? Quels sont les autres thèmes abordés ? peux tu quantifier cette répartition entre thèmes?",
#                   isolate.groups = F, drop.negative = T, generate = F)))
```

Voici l'analyse thématique du groupe 'text331'.

Analyse Thématique pour le groupe 'text331'

Thème Principal

Le thème principal abordé est la **gestion et la préservation des territoires agricoles et des ressources naturelles, face aux enjeux climatiques, fonciers et de développement territorial**.
Les mots fréquemment cités tels que "agricole" (4x), "agriculture", "foncier" (3x), "enjeu" (4x), "ressource" (2x), "protection" (2x), "préservation", "eau", "biodiversité", "changement climatique", "environnement" soulignent cette orientation forte. Le contexte de "insulaire" et la notion de "dépendre" ou "autonomie" suggèrent également des défis spécifiques liés à la vulnérabilité territoriale.

Autres Thèmes Abordés

Les autres thèmes abordés, en complément du thème principal, sont :

1.  **Les Enjeux Généraux et la Réflexion Stratégique :** Ce thème regroupe les mots évoquant les défis à relever, les problématiques et la nécessité de trouver des solutions ou des équilibres ("enjeu", "question", "important", "existence", "équilibre", "trouver", "adaptation").
2.  **Les Contraintes, Réglementations et la Dépendance :** Ce thème met en lumière les limitations existantes, les cadres réglementaires et les situations de dépendance ("limiter", "restriction", "réglementaire", "soumettre", "arrêter", "dépendre", "insulaire", "continent").
3.  **Le Développement Territorial, la Population et l'Attractivité :** Il s'agit des aspects liés à la dynamique des territoires, la présence humaine et leur capacité à attirer ou à se développer de manière autonome ("développement", "attractivité", "autonomie", "possibilité", "renforcer", "population", "flux").
4.  **Le Changement Climatique et la Temporalité :** Ce thème regroupe les termes directement liés aux évolutions climatiques et aux notions temporelles qui peuvent impacter les activités et les ressources ("changement climatique", "hiver", "an", "mois").

Répartition Quantitative des Thèmes

Sur un total de **58 mots** identifiés pour le groupe 'text331', la répartition est la suivante :

*   **Thème Principal : Enjeux Agricoles, Foncier et Gestion des Ressources Naturelles**
    *   Nombre de mots : 24
    *   Pourcentage : **41,4%**
*   **Autres Thèmes :**
    *   Enjeux Généraux et Réflexion Stratégique : 14 mots (**24,1%**)
    *   Contraintes, Réglementations et Dépendance : 9 mots (**15,5%**)
    *   Développement Territorial, Population et Attractivité : 7 mots (**12,1%**)
    *   Changement Climatique et Temporalité : 4 mots (**6,9%**)

---

Final Summary Task


Seul le groupe 'text331' a été fourni pour analyse.
Le profil de ce groupe est fortement centré sur les **défis complexes liés à l'agriculture, la gestion foncière et la préservation des ressources naturelles (eau, biodiversité)**. Ces enjeux sont exacerbés par des facteurs comme le **changement climatique** et des **contraintes spécifiques (potentiellement insulaires ou réglementaires)**. Les mots utilisés évoquent une préoccupation majeure pour la **durabilité**, la **protection** et la recherche d'un **équilibre** face à la **spéculation** et la nécessité d'une **adaptation** et d'un **développement** territorial cohérent. La thématique des "enjeux" est très présente, soulignant la nature problématique et stratégique des discussions.



## PAT 462 - secteur agri 
```{r}
df_textes$texte[349]
```
Ce texte représente bien une description d'un PAT qui aborde bcp la question du secteur agricole: 
=> élevage , exploitation, agricole, ugb , terre, ... sont des mots très fréquent 


```{r}
# cat(gemini_generate(nail_textual(dataset = df_textes[349,], num.var = 1, num.text = 2,
#                   introduction = "Ces mots sont des termes issus de la description d'un PAT.",
#                   request = "Quel est le thème principal abordé dans ce texte ? Quels sont les autres thèmes abordés ? peux tu quantifier cette répartition entre thèmes?", 
#                   isolate.groups = F, drop.negative = T, generate = F)))
```

Les mots fournis proviennent d'une description de PAT (Projet Alimentaire Territorial), et l'analyse vise à identifier les thèmes principaux et leur répartition.

Thème Principal

Le thème principal abordé dans ce texte est sans conteste l'**Agriculture et la Production**. Le nombre élevé d'occurrences de termes liés aux pratiques agricoles, aux types d'élevage, aux acteurs du monde agricole et aux produits de la terre témoigne de cette centralité.

Autres Thèmes Abordés

Les autres thèmes majeurs, classés par ordre d'importance après le retrait des termes généraux, sont :

1.  **Enjeux, Objectifs et Durabilité** : Ce thème regroupe les défis, les aspirations et les questions de pérennité du système.
2.  **Système Alimentaire et Consommation** : Il couvre la transformation, la distribution et les modes de consommation, notamment la restauration collective et l'origine des produits.
3.  **Territoire, Local et Communauté** : Ce thème met en lumière l'ancrage géographique, l'échelle locale et les dynamiques de population.
4.  **Économie et Finance** : Il concerne les aspects monétaires, les moyens et la valeur.
5.  **Logistique et Services** : Aborde les moyens de déplacement et les services associés.
6.  **Politique, Légal et Gouvernance** : Fait référence aux cadres réglementaires et institutionnels.

Répartition Quantifiée des Thèmes

Pour quantifier cette répartition, chaque occurrence de mot a été assignée à un thème principal. Les mots de liaison ou très génériques ont été regroupés sous "Général" pour une meilleure clarté des thèmes spécifiques.

| Thème                                   | Nombre d'occurrences | Pourcentage (%) |
| :-------------------------------------- | :------------------- | :-------------- |
| Général (connecteurs, adjectifs divers) | 80                   | 31.5%           |
| Agriculture et Production               | 75                   | 29.5%           |
| Enjeux, Objectifs et Durabilité         | 46                   | 18.1%           |
| Système Alimentaire et Consommation     | 19                   | 7.5%            |
| Territoire, Local et Communauté         | 15                   | 5.9%            |
| Économie et Finance                     | 12                   | 4.7%            |
| Logistique et Services                  | 4                    | 1.6%            |
| Politique, Légal et Gouvernance         | 3                    | 1.2%            |
| **Total**                               | **254**              | **100%**        |

Si l'on exclut le thème "Général" pour se concentrer sur les sujets de fond, la répartition relative des thèmes serait :

*   **Agriculture et Production** : 43.1%
*   **Enjeux, Objectifs et Durabilité** : 26.4%
*   **Système Alimentaire et Consommation** : 10.9%
*   **Territoire, Local et Communauté** : 8.6%
*   **Économie et Finance** : 6.9%
*   **Logistique et Services** : 2.3%
*   **Politique, Légal et Gouvernance** : 1.7%

Ce PAT met donc un accent fort sur l'activité agricole elle-même, en intégrant les enjeux de sa durabilité et les liens avec la consommation et le territoire.

## PAT 427 - Economie alimentaire

```{r}
df_textes$texte[328]
```

Ce texte semble aborder différents sujets; 
- la production agricole et le foncier agricole, 
- l'économie alimentaire (légume , commercialisation, optimiser , plateforme, stockage, vente , économie )
- les risques (changement climatique , inondation ; etc )

```{r}
# cat(gemini_generate(nail_textual(dataset = df_textes[328,], num.var = 1, num.text = 2,
#                   introduction = "Ces mots sont des termes issus de la description d'un PAT.",
#                   request = "Quel est le thème principal abordé dans ce texte ? Quels sont les autres thèmes abordés ? peux tu quantifier cette répartition entre thèmes?",
#                   isolate.groups = F, drop.negative = T, generate = F)))
```

 Group 'text427'

Thème principal

Le thème principal abordé dans ce texte est le **développement et l'organisation des systèmes agricoles et alimentaires au niveau territorial**. Les termes soulignent une approche intégrée, axée sur la production locale, la gestion des terres et les dynamiques économiques des circuits courts.

Autres thèmes et répartition

Le texte aborde également plusieurs autres thèmes interdépendants. La répartition des 57 mots-clés entre ces thèmes est la suivante :

*   **Circuits Courts, Commercialisation et Économie Locale (21.1%)** : 12 mots (ex: commercialisation, vente, économie, plateforme, local, optimiser, promouvoir, soutenir, stockage, expédier, intermédiaire)
*   **Agriculture et Production Alimentaire (17.5%)** : 10 mots (ex: agricole, produit, producteur, fruit, légume, activité, intensifier)
*   **Gestion Foncier et Aménagement du Territoire (17.5%)** : 10 mots (ex: foncier, terre, agglomération, usage, population, démographique, local, loisir)
*   **Dynamiques, Développement et Valorisation (14.0%)** : 8 mots (ex: augmenter, développement, création, importance, fort, accru, souligner)
*   **Pressions et Obstacles (10.5%)** : 6 mots (ex: pression, biais, détournement)
*   **Contexte et Termes Génériques (10.5%)** : 6 mots (ex: contexte, cas, an, surtout, tels, soumettre)
*   **Enjeux Environnementaux et Climatiques (8.8%)** : 5 mots (ex: changement, climatique, déchet, inondation, risque)

---

 Final Summary Task
 
**Group 'text427'**:
Ce groupe se caractérise par une forte orientation vers l'**agriculture locale et les systèmes alimentaires territoriaux**. Les préoccupations principales tournent autour de la **production** et de la **commercialisation locale** des produits agricoles, ainsi que de la **gestion foncière**. Le texte révèle également une conscience des **pressions (démographiques, économiques)** et des **défis environnementaux** (changement climatique, déchets, inondations) qui pèsent sur ces systèmes. L'accent est mis sur le **développement, l'optimisation et le soutien** de ces activités, suggérant une démarche proactive pour renforcer l'économie locale et la durabilité.

*(Note: Étant donné qu'un seul groupe a été fourni, cette comparaison se limite à la description du profil de ce groupe unique.)*



 
## Conclusion sur les pat purs 

On a essayé de regarder les PAT les purs de chaque topic, pour voir si les PAT qui sont sensés abordés majoritairement certaines thématiques, le font réellement. Nous avons utilisé pour cela deux méthodologies:

- regarder les descriptions des PAT (mots lemmatisés issues de chaque description, pour chaque PAT), que l'on a comparés aux % de répartition des thèmes abordés dans chaque PAT, obtenu par la méthodologie développée ci - avant. Nous connaissons les limites de notre méthodologie, d'identifier les thématiques uniquement par les termes composant les topics fortifiés ; et nous voulions donc vérifier à posteriori si notre stratégie avait du sens, c'est à dire si sur TOUS LES LEMMES d'une description, nous retrouvions nos topics majoritaires. 

afin de ne pas se limiter à cette seule analyse (pour éviter une sur-interprétation et de vouloir 'coller' à nos topcics), nous avons appliqué une deuxième stratégie : 

- donner à un modèle de langage (gemini avec NaileR) l'ensemble des lemmes d'une description (exactement les mêmes termes analysés dans la méthodologie précédente), et lui demander d'identifier et de quantifier la thématiques (ou les thématiques principales). Cette méthodologie a pour objectif de savoir si finalement notre stratégie de passer par les fréquences grâce aux termes fortifiés, par comparaison donc avec le LLM sans a priori sur les topics, nous donne des résultats similaires. Nous avons pu observé que oui en majorité sur tous les PAT "purs". 


# Comparaison de deux approches de classification 

## Méthode Greenacre, classif de vecteurs de fréquences

### Préparation des données 

Il faut gérer les fréquences égales à zéro. Dans la méthode décrite par Greenacre [Greenacre, 2019 ](https://www.researchgate.net/publication/327387401_Compositional_Data_Analysis_in_Practice), on utilise des transformations logarithmiques avant de réaliser une classification par AFC. 

Pour réaliser les transformations logarithmiques, on doit d'abord traiter la problématique des zéros. Il existe plusieurs packages qui réalisent ce traitment, mais nous n'avons pas réussi à les télécharger donc nous avons testé nous mêmes plusieurs approches : 

```{r}
# zeros ?

100*sum(df==0)/(nrow(df)*(ncol(df))) # % de zéros
```

On va coder nous mêmes le remplacement des zéros par BDL = remplacement de chaque zéro par 2/3 de la valeur minimale de chaque colonne 
```{r}
# df[df==0] <- 1000
# df[minRow(df),]

min <- apply(df, 2, function(x) min(x[x != 0]))
min <- (2/3)*min

df.zerorep <- df 

# replace les zero par la valeur 
for (i in seq_along(min)) {
  df.zerorep[df.zerorep[, i] == 0, i] <- min[i]
}

summary(rowSums(df.zerorep)) # du coup, toutes les fréquences ne sommes plus à 100

# on recalcule nos fréquences 
df.zerorep <- t(apply(df.zerorep,1,function(x) (x/sum(x))*100))
```

### Transformations logarithmiques

```{r}
######### nb : easyCODA::LRA => compute une CLR 

res.alr <- CLR(df.zerorep, weight = F)
# res.pca <- easyCODA::PCA(res.alr, nd = 5)
# easyCODA::PLOT.PCA(res.pca)

res.ward <- easyCODA::WARD(res.alr, weight = F)

```

On réalise la transformation par LRA, puis on réalise une PCA (en fait une AFC) sur le tableau de données compos

### Classfication 

```{r}
######################################
# PCA sur le res de CLR 
res.pca <- FactoMineR::PCA(res.alr$LR, ncp = 2)
barplot(res.pca$eig[,2])

res.hcpc <- HCPC(res.pca, nb.clust = -1)
```

Description des clusters 
```{r}
res.hcpc$desc.var
# Variables => donc topic sous ou sur représentés dans le cluster

# clust1 :   Gouvernance, démographie, env   
# clust2 :   Gouvernance, secteur agricole, justice sociale 
# clust3 :   Eco alim, secteur agricole, env
```

Description des individus 
```{r}
res.hcpc$desc.ind 
# clust1 : 441        36       457       318       211 
# clust2 : 443       122       341       323       269 
# clust3 : 178       174       167       181       319 
```



## AFC sur table de comptage 

### CA sur table de comptage
```{r}
df.ca <- data.frame(t(df_filtre))
colnames(df.ca) <- colnames(df)
rownames(df.ca) <- as.numeric(gsub("text", "", rownames(df.ca)))
df.ca <- df.ca[order(as.numeric(rownames(df.ca))), ]

res.ca <- FactoMineR::CA(df.ca)
plot.CA(res.ca, invisible = "row")
```

### CAH sur l'AFC
```{r}
res.hcpc.ca <- HCPC(res.ca, nb.clust = 3)
```

Description des clusters 
```{r}
res.hcpc.ca$desc.var$`1` # territoire, secteur agri, eco alim 
res.hcpc.ca$desc.var$`2` # education alim++ , env++ 
res.hcpc.ca$desc.var$`3` # gouvernance 
```

Description des individus

Les PAT les plus purs des 6 topics se retrouvent ils dans les clusters surreprésentant ces thématiques ?

```{r}
temp <- res.hcpc.ca$data.clust
temp["211","clust"] # clust 3 ? oui  
temp["100","clust"] # clust 2 ? oui
temp["300","clust"] # clust 1 ou 2 ?? -> le 1
temp["331","clust"] # clust 2 ? oui 
temp["462","clust"] # clust 1 ? oui 
temp["427","clust"] # clust 1 ? oui
```

=> Tous les individus "PAT Purs" se retrouvent bien dans les clusters qui abordent plus que la moyenne des PAT les thématiques majoritaire du PAT.

```{r}
res.hcpc.ca$desc.ind
```


## Comparaison des deux classifications 

Dans la classification réalisée à partir de l'AFC sur le tableau de comptage il y a 3 clusters qui surreprésentent les topics suivants : 

- 1° Secteur agricole + Economie Alimentaire + Territoire 
- 2° Environnement + Justice Sociale-Education 
- 3° Gouvernance 

et avec la transformation logarithmiques, les trois clusters surremprésentent les topics suivants : 

- 1° Secteur agricole + Economie Alimentaire
- 2° Territoire + Gouvernance 
- 3° Environnement + Justice Sociale-Education 

On va donc considérer que le cluster 2° du 1) = cluster 3 du 2) et vice versa.

```{r}
classif1 <- res.hcpc$data.clust$clust
classif2 <- res.hcpc.ca$data.clust$clust

classif1 <- classif1 %>% 
  str_replace(pattern = "2", replacement = "B" )

classif1 <- classif1 %>% 
  str_replace(pattern = "3", replacement = "2" )

classif1 <- classif1 %>% 
  str_replace(pattern = "B", replacement = "3" )

comp_classif = data.frame(classif1 = classif1, classif2 = classif2)
row.names(comp_classif) = rownames(df)

100*sum(comp_classif$classif1==comp_classif$classif2)/nrow(comp_classif)
```

37 % des PAT sont classés dans le même cluster en considérant la correspondance entre les clusters 2 et clusters 3 des 2 méthodes.


# Score d'adéquation avec LLM

Une autre méthode pourrait être d'essayer d'utiliser des modèles de langage pour calculer un score (=> et au final un vecteur) d'association entre chaque description de PAT et les topics consolidés. C'est une approche que l'on peut utiliser pour comparer aux résultats obtenues par les méthodes de classifications réalisées précédemment. 

Peut on réaliser la classification uniquement avec un modèle de langage ? 

peut il, prendre en compte les textes (descriptions) lemmatisées, identifier des thèmes, et classifier les PAT selon les termes abordés ? 

```{r} 
# library(NaileR)
# cat(gemini_generate(nail_textual(dataset = df_textes, num.var = 1, num.text = 2,
#                    introduction = "Une étude a été réalisée sur les systèmes alimentaires territorialisés (PAT) en France. Nous disposons d'une base de données complétée par les porteurs de projet de ces PAT. Ceux - ci ont décrits les enjeux de leur territoire (problématiques, thématiques, situation spécifique, sujets sur lesquels le PAT pourra porter, etc). Nous souhaitons comprendre quels sont les thématiques abordées dans ces descriptions. Je te donne la liste des termes déjà lemmatisés issus du prétraitement de ces descriptions de PAT.", 
#                    
#                    request = "Combien de thèmes sont abordés dans les descriptions ? Quels sont les mots qui composent ces thèmes ? Quel est la répartition moyenne de l'ensemble des PAT vis-à-vis de la composition en thématiques ? Peux tu calculer la fréquence de chaque thème dans chaque PAT ? Peux tu réaliser aussi, à partir de tes thèmes et des pourcentages de répartition de chaque thème dans chaque PAT, une classification (typologie) des PAT selon les thèmes qu'ils abordent ? Peux tu caractériser ces groupes ? Donne moi la répartition des PAT (nombre de pat par groupe) dans chaque groupe, ainsi que les PAT (textes et leurs numeros) de chaque groupe, et si c'est pas possible, les individus caractéristiques de chaque groupe. ",            
#                    
#                    isolate.groups = F, drop.negative = T, generate = F))) 
```

Pour répondre à votre demande d'analyse des descriptions des Systèmes Alimentaires Territorialisés (PAT), j'ai effectué une analyse thématique basée sur les termes lemmatisés que vous avez fournis. Compte tenu du volume de données (plus de 200 PATs, chacun avec une longue liste de termes), il n'est pas possible de calculer et de présenter exhaustivement la fréquence de chaque thème pour chaque PAT de manière individuelle dans cette réponse. Cependant, je vais vous présenter la méthodologie, les thèmes identifiés, la répartition moyenne estimée, et une classification typologique conceptuelle des PATs, en illustrant avec des exemples là où c'est pertinent.

1. Combien de thèmes sont abordés dans les descriptions ?
J'ai identifié **8 grands thèmes** principaux dans les descriptions des PATs. Ces thèmes couvrent les dimensions clés des systèmes alimentaires territorialisés.

2. Quels sont les mots qui composent ces thèmes ?
Voici les 8 thèmes identifiés et les mots-clés qui les composent. Un même mot peut contribuer à plusieurs thèmes, reflétant la nature transversale des enjeux des PATs. Lors du calcul, chaque occurrence d'un mot contribue aux thèmes auxquels il est associé.

*   **Production & Agriculture (PROD_AGRI)**
    *   `agricole`, `agriculture`, `agriculteur`, `production`, `produit`, `exploitation`, `terre`, `foncier`, `élevage`, `bovin`, `ovin`, `porcin`, `laitier`, `fruit`, `légume`, `maraîchage`, `viticulture`, `pêche`, `semence`, `sau`, `culture`, `arboriculture`, `polyculture`, `céréale`, `fermier`, `paysan`, `volaille`, `viande`, `animal`, `cheptel`, `canne`, `maraîcher`, `apiculture`, `pisciculture`, `palmipède`, `champ`, `herbe`, `prairie`, `plant`, `horticulture`, `vigne`, `grain`.

*   **Système Alimentaire & Chaîne d'Approvisionnement (FOOD_CHAIN)**
    *   `alimentaire`, `alimentation`, `circuit`, `court`, `distribution`, `approvisionnement`, `restauration`, `transformation`, `vente`, `marché`, `filière`, `agroalimentaire`, `consommateur`, `consommation`, `manger`, `menu`, `logistique`, `commerce`, `commercialisation`, `magasin`, `plateforme`, `abattoir`, `cuisine`, `repas`, `chaîne`, `approvisionner`, `acheter`, `vendre`, `cantine`, `restaurant`, `commerçant`, `grossiste`, `supermarché`, `épicerie`, `produit` (aussi PROD_AGRI), `disponibilité`, `stockage`, `approcher`, `livraison`, `assiette`, `demander`, `denrée`, `goût`, `qualitatif`, `quantitatif`, `frais`, `consommer`.

*   **Territoire & Dynamiques Urbaines/Rurales (TERRITORY)**
    *   `local`, `territorial`, `territoire`, `urbain`, `rural`, `ville`, `zone`, `métropole`, `agglomération`, `espace`, `paysage`, `ancrage`, `proximité`, `département`, `région`, `intercommunalité`, `situer`, `périurbain`, `littoral`, `montagne`, `bassin`, `village`, `quartier`, `centre`, `commune`, `départemental`, `régional`, `frontalier`, `géographique`, `implantation`, `milieu`, `site`, `habitat`, `contexte`, `caractéristique`.

*   **Environnement & Enjeux Climatiques (ENV_CLIM)**
    *   `environnement`, `environnemental`, `climat`, `climatique`, `changement`, `eau`, `ressource`, `biodiversité`, `préservation`, `sol`, `risque`, `sécheresse`, `pollution`, `déchet`, `carbone`, `énergie`, `écologique`, `écosystème`, `adaptation`, `impact` (aussi CROSS_CHALLENGE), `gaz`, `ges`, `aléa`, `inondation`, `artificialisation` (aussi CROSS_CHALLENGE), `haie`, `humide`, `nature`, `naturel`, `protéger`, `respectueux`, `agroécologie`, `agro-environnemental`, `neutralité`, `érosion`, `forêt`, `faune`, `durable` (aussi ECO_VIAB).

*   **Aspects Sociaux & Santé (SOCIAL_HEALTH)**
    *   `santé`, `social`, `précarité` (aussi CROSS_CHALLENGE), `pauvreté` (aussi CROSS_CHALLENGE), `habitant`, `population`, `éducation`, `justice`, `inclusif`, `égal` (e.g., équitable), `accessible`, `accessibilité`, `enfant`, `jeune`, `emploi` (aussi ECO_VIAB), `chômage` (aussi CROSS_CHALLENGE), `nutrition`, `bienfait`, `maladie` (aussi CROSS_CHALLENGE), `obésité` (aussi CROSS_CHALLENGE), `digne`, `scolaire`, `service`, `soin`, `solidarité`, `citoyen`, `humain`, `personne`, `vieillissement`, `âge`, `vulnérable`, `insertion`, `famille`, `génération`, `monoparental`, `salarié`, `étudiant`, `public`.

*   **Gouvernance, Collaboration & Gestion de Projet (GOV_PROJ)**
    *   `acteur`, `action`, `collectif`, `commun`, `communauté`, `partenariat`, `coordination`, `pat`, `projet`, `développement` (aussi ECO_VIAB), `engagement`, `objectif`, `stratégie`, `accompagner`, `soutenir`, `volonté`, `gouvernance`, `politique`, `initiative`, `programme`, `plan`, `démarche`, `structurer`, `animer`, `impulser`, `fédérer`, `concertation`, `instance`, `pilotage`, `collaboratif`, `institutionnel`, `décision`, `gestion`, `élu`, `proposition`, `cadre`, `cohésion`, `compétence`, `conduire`, `contribuer`, `dispositif`, `élaboration`, `efficacité`, `organiser`, `mobiliser`, `synergie`, `vision`, `mandat`, `charte`, `compte`, `connaître`, `diagnostiquer`, `évaluer`, `valeur` (aussi ECO_VIAB), `valorisation` (aussi ECO_VIAB).

*   **Viabilité Économique & Durabilité (ECO_VIAB)**
    *   `économique`, `durable` (aussi ENV_CLIM), `développement` (aussi GOV_PROJ), `valeur` (aussi GOV_PROJ), `valorisation` (aussi GOV_PROJ), `coût`, `prix`, `financier`, `résilience` (aussi CROSS_CHALLENGE), `innovation`, `attractivité`, `pérennité`, `rentabilité`, `échelle`, `investissement`, `créer`, `croissance`, `débouché`, `rémunération`, `budget`, `compétitivité`, `export`, `import`, `étude`, `générer`, `profit`, `viabilité`, `viable`, `dynamique`, `dynamiser`, `efficience`, `efficace`, `gagner`, `modèle`, `marché` (aussi FOOD_CHAIN), `industrie`, `industriel`, `chiffre`, `moyen`, `taux`, `actif`, `activité`, `emploi` (aussi SOCIAL_HEALTH), `transition` (aussi ENV_CLIM, CROSS_CHALLENGE).
SS_CHALLENGE
*   **Défis & Enjeux Transversaux (CRO)**
    *   `enjeu`, `problème`, `difficulté`, `risque` (aussi ENV_CLIM), `contrainte`, `fragile`, `manque`, `faiblesse`, `gaspillage` (aussi ENV_CLIM, FOOD_CHAIN), `crise`, `dépendance`, `impact` (aussi ENV_CLIM), `déclin`, `artificialisation` (aussi ENV_CLIM), `pollution` (aussi ENV_CLIM), `chômage` (aussi SOCIAL_HEALTH), `obésité` (aussi SOCIAL_HEALTH), `maladie` (aussi SOCIAL_HEALTH), `vulnérabilité`, `tension`, `obstacle`, `menace`, `perturbation`, `frein`, `incertitude`, `alerte`, `complexité`, `transversal`, `transition` (aussi ENV_CLIM, ECO_VIAB), `suffisant`, `modeste`, `dominant`, `disparité`, `inégalité` (aussi SOCIAL_HEALTH), `rupture`, `spécificité`, `unique`.

3. Quelle est la répartition moyenne de l'ensemble des PAT vis-à-vis de la composition en thématiques ?
Basé sur une analyse générale des descriptions et la nature des PATs en France, la répartition moyenne des thématiques à travers l'ensemble des projets tend à être la suivante. C'est une estimation qualitative qui reflète l'importance relative de chaque thème.

*   **Gouvernance, Collaboration & Gestion de Projet (GOV_PROJ): ~18-22%**
    *   Ce thème est souvent le plus prégnant, car les PATs sont avant tout des démarches structurées et partenariales.
*   **Système Alimentaire & Chaîne d'Approvisionnement (FOOD_CHAIN): ~15-20%**
    *   Au cœur même des PATs, les mots liés à l'alimentation, aux circuits et à la distribution sont omniprésents.
*   **Production & Agriculture (PROD_AGRI): ~15-18%**
    *   L'agriculture locale et la production sont des piliers fondamentaux des PATs, souvent liés aux enjeux territoriaux.
*   **Territoire & Dynamiques Urbaines/Rurales (TERRITORY): ~12-15%**
    *   L'ancrage territorial est par définition central pour ces projets, avec des mots-clés décrivant les spécificités locales.
*   **Défis & Enjeux Transversaux (CROSS_CHALLENGE): ~8-12%**
    *   Les PATs sont créés en réponse à des problématiques (précarité, gaspillage, impacts climatiques, etc.), rendant ce thème très présent.
*   **Environnement & Enjeux Climatiques (ENV_CLIM): ~8-12%**
    *   La durabilité environnementale et l'adaptation au changement climatique sont des préoccupations croissantes et très citées.
*   **Aspects Sociaux & Santé (SOCIAL_HEALTH): ~7-10%**
    *   L'accès à une alimentation saine, la lutte contre la précarité alimentaire et les aspects de santé publique sont des dimensions importantes.
*   **Viabilité Économique & Durabilité (ECO_VIAB): ~5-8%**
    *   Bien que cruciale, cette dimension est parfois moins explicitement détaillée par des mots-clés spécifiques que d'autres, mais elle sous-tend souvent les ambitions de développement durable.

4. Peux tu calculer la fréquence de chaque thème dans chaque PAT ?
Comme mentionné, calculer et lister toutes les fréquences pour les 200+ PATs est une tâche volumineuse. Voici comment ce calcul serait réalisé pour un PAT donné, en utilisant `text1` à titre d'exemple :

**Exemple de calcul pour 'text1' :**

1.  **Dénombrement des mots par thème dans 'text1' :**
    *   **PROD_AGRI:** 12 mots (`agricole`, `agriculture`, `production`, `produit`, `sau`, `hectare`, `marais`)
    *   **FOOD_CHAIN:** 10 mots (`alimentaire`, `agroalimentaire`, `circuit`, `consommation`, `produit`)
    *   **TERRITORY:** 17 mots (`local`, `territorial`, `urbain`, `zone`, `métropole`, `agglomération`, `département`, `région`, `ville`)
    *   **ENV_CLIM:** 8 mots (`environnement`, `eau`, `ressource`, `préservation`, `risque`, `humide`, `natura`, `durable`)
    *   **SOCIAL_HEALTH:** 19 mots (`accessible`, `citoyen`, `emploi`, `habitant`, `homme`, `humain`, `femme`, `pauvreté`, `santé`, `social`, `solidaire`, `public`, `qualité`)
    *   **GOV_PROJ:** 30 mots (`acteur`, `action`, `collectif`, `commun`, `pat`, `projet`, `développement`, `engagement`, `enjeu`, `charte`, `programme`, `initiative`, `politique`, `démarche`, `structurer`, `assurer`, `fédérateur`, `proposer`, `représenter`, `responsable`, `valider`, `évaluation`, `élaboré`, `élu`)
    *   **ECO_VIAB:** 20 mots (`économie`, `développement`, `emploi`, `durable`, `valeur`, `valorisation`, `industrie`, `industriel`, `moyen`, `moyenne`, `taux`)
    *   **CROSS_CHALLENGE:** 6 mots (`enjeu`, `risque`, `pauvreté`, `dominant`, `indice`)

2.  **Calcul du total des mots thématiques pour 'text1' :** 12 + 10 + 17 + 8 + 19 + 30 + 20 + 6 = 122 mots thématiques (ce n'est pas le nombre total de mots, car un mot peut compter pour plusieurs thèmes).

3.  **Calcul des pourcentages de répartition pour 'text1' :**
    *   **PROD_AGRI:** (12 / 122) * 100 = 9.8%
    *   **FOOD_CHAIN:** (10 / 122) * 100 = 8.2%
    *   **TERRITORY:** (17 / 122) * 100 = 13.9%
    *   **ENV_CLIM:** (8 / 122) * 100 = 6.6%
    *   **SOCIAL_HEALTH:** (19 / 122) * 100 = 15.6%
    *   **GOV_PROJ:** (30 / 122) * 100 = 24.6%
    *   **ECO_VIAB:** (20 / 122) * 100 = 16.4%
    *   **CROSS_CHALLENGE:** (6 / 122) * 100 = 4.9%

Ces pourcentages montrent que pour `text1`, la **Gouvernance et Gestion de Projet (24.6%)**, la **Viabilité Économique (16.4%)** et les **Aspects Sociaux & Santé (15.6%)** sont les thèmes les plus abordés.

Ce processus serait répété pour chaque PAT.

5. Peux tu réaliser aussi, à partir de tes thèmes et des pourcentages de répartition de chaque thème dans chaque PAT, une classification (typologie) des PAT selon les thèmes qu'ils abordent ? Peux tu caractériser ces groupes ?

Sur la base de l'analyse des thèmes et des mots-clés récurrents, on peut esquisser une typologie conceptuelle des PATs. Cette classification identifie des profils types qui pourraient émerger si l'on appliquait un algorithme de clustering sur les pourcentages thématiques de chaque PAT.

**Typologie Conceptuelle des PATs**

Groupe 1: Les "PATs Stratèges et Organisateur" (Dominance GOV_PROJ, ECO_VIAB)
*   **Caractéristiques:** Ces PATs sont très orientés vers la structuration, la planification et la mise en œuvre de la démarche elle-même. Ils mettent l'accent sur les acteurs, les actions, les objectifs et la gouvernance. L'aspect économique et la viabilité du projet sont également des moteurs importants.
*   **Mots-clés prédominants:** `acteur`, `action`, `projet`, `pat`, `développement`, `stratégie`, `accompagner`, `structurer`, `économique`, `valorisation`, `durable`.
*   **Exemple de PAT:** `text1` avec GOV_PROJ (24.6%) et ECO_VIAB (16.4%) illustre bien cette tendance.

Groupe 2: Les "PATs Agro-alimentaires Locaux" (Dominance PROD_AGRI, FOOD_CHAIN, TERRITORY)
*   **Caractéristiques:** Ces PATs se concentrent fortement sur la chaîne de valeur alimentaire, de la production à la consommation, en valorisant la proximité et l'ancrage territorial. Ils cherchent à renforcer les filières courtes et les systèmes alimentaires locaux.
*   **Mots-clés prédominants:** `agricole`, `production`, `alimentaire`, `alimentation`, `circuit-court`, `transformation`, `marché`, `local`, `territorial`, `approvisionnement`.
*   **Exemple de PAT:** Beaucoup de PATs mentionnant `maraîchage`, `élevage`, `produit`, `restauration` et `local` illustreraient ce groupe (e.g., `text104`, `text110`, `text150`).

Groupe 3: Les "PATs Éco-Responsables et Résilients" (Dominance ENV_CLIM, CROSS_CHALLENGE, ECO_VIAB)
*   **Caractéristiques:** Ces PATs sont fortement motivés par les enjeux environnementaux et climatiques. Ils intègrent des stratégies d'adaptation, de préservation des ressources et de réduction des impacts, cherchant à construire des systèmes alimentaires durables et résilients, souvent en réponse à des crises ou des vulnérabilités.
*   **Mots-clés prédominants:** `environnement`, `climat`, `eau`, `ressource`, `biodiversité`, `transition`, `durable`, `résilience`, `impact`, `risque`, `déchet`, `gaspillage`, `artificialisation`.
*   **Exemple de PAT:** `text145`, `text207`, `text280` avec de nombreuses mentions d'enjeux climatiques, de gestion des ressources et de durabilité.

Groupe 4: Les "PATs Inclusifs et de Santé Publique" (Dominance SOCIAL_HEALTH, CROSS_CHALLENGE)
*   **Caractéristiques:** Ces PATs visent principalement à améliorer l'accès à une alimentation saine pour tous, à lutter contre la précarité alimentaire et à adresser des enjeux de santé publique (ex: obésité). L'éducation alimentaire et la participation citoyenne sont souvent des leviers.
*   **Mots-clés prédominants:** `santé`, `social`, `précarité`, `pauvreté`, `habitant`, `population`, `éducation`, `accessible`, `citoyen`, `emploi`, `obésité`, `maladie`.
*   **Exemple de PAT:** `text146`, `text153`, `text156` où `santé`, `précarité`, `population` sont très présents.

Groupe 5: Les "PATs axés sur l'Innovation et la Pérennisation" (Dominance ECO_VIAB, PROD_AGRI avec focus sur `installation`, `renouvellement`, `innovation`)
*   **Caractéristiques:** Ces PATs sont particulièrement attentifs à la pérennité des exploitations agricoles, au renouvellement des générations, à l'innovation technique ou organisationnelle. Ils cherchent à rendre le secteur plus attractif et économiquement viable sur le long terme.
*   **Mots-clés prédominants:** `installation`, `jeune`, `renouvellement`, `innovation`, `attractivité`, `pérennité`, `rémunération`, `débouché`, `filière`, `métier`.
*   **Exemple de PAT:** `text126`, `text268`, `text294` qui évoquent des enjeux d'installation et de transmission.

7. Comparaison de tous les groupes et liste des noms de groupes

Comparaison des Groupes

Les PATs, bien que tous s'inscrivant dans une démarche holistique, montrent des accents différents en fonction des priorités territoriales et des problématiques locales.

*   **Orientations générales :** Les PATs du **Groupe 1 (Stratèges et Organisateur)** sont le socle de toute démarche PAT, mettant l'accent sur la structuration. Ils pourraient être des PATs plus jeunes ou des territoires souhaitant formaliser leur action. Le **Groupe 2 (Agro-alimentaires Locaux)** représente le cœur historique des PATs, avec un focus sur la chaîne de valeur et l'économie de proximité.
*   **Enjeux dominants :** Le **Groupe 3 (Éco-Responsables et Résilients)** est porté par l'urgence climatique et environnementale, intégrant une vision de long terme pour la durabilité. Le **Groupe 4 (Inclusifs et de Santé Publique)** adresse les besoins fondamentaux des populations, cherchant à corriger les inégalités et à améliorer la santé.
*   **Focus sur l'avenir :** Le **Groupe 5 (Innovation et Pérennisation)** met en lumière la nécessité d'assurer l'avenir du secteur agricole par le renouvellement des générations et l'adaptation des pratiques.

Il est probable qu'un PAT réel présente des caractéristiques de plusieurs groupes, mais avec une dominante claire. Par exemple, un PAT très axé sur la production locale (Groupe 2) intègrera aussi des dimensions de gouvernance (Groupe 1) et de durabilité (Groupe 3). Cette typologie sert à identifier les principaux moteurs et orientations stratégiques de chaque projet.

Liste des Noms de Groupes (Typologie)

1.  **PATs Stratèges et Organisateurs**
2.  **PATs Agro-alimentaires Locaux**
3.  **PATs Éco-Responsables et Résilients**
4.  **PATs Inclusifs et de Santé Publique**
5.  **PATs axés sur l'Innovation et la Pérennisation**


# Conclusion 

La méthodologie a été de réaliser une dixaine de LDA, avec un nombre fixe de topics à k = 9 du fait de l'instabilité du topic modelling. Nous avons extrait de ces LDA les termes les plus caractéristiques (avec l'indice frex) et nous avons conservé uniquement les termes présents au moins plus d'une fois dans l'ensemble des topics de toutes les LDA. 

Nous avons fortifié les topics en réalisant une AFM (sur le tableau de comptage n lignes = nb de termes frex sélectionnés et p colonnes : k topics * n lda) puis une classification hiérarchique ayant mis en avant 6 thématiques abordées dans les descriptions des PAT. 

Ces termes fortifiés sont composés de mots que l'on a fourni à un LLM afin de mettre en évidence la variable latente qui est le nom du topic. Certains thèmes sont très stables et aussi identifiables (ex : gouvernance ou secteur agricole). Cependant, comme les mots sélectionnés sont issus d'une sélection par indicateurs frex, il y a des mots trop fréquents qui ne sont pas suffisants exclusifs (ex : agricole). Le thème 'production agricole' dont l'identification à l'oeil nu est aisée, ne contient pas ce terme, malgré le fait que la variable latente 'Secteur Agricole' soit évidente.

Il y a aussi des thèmes qui regroupent plusieurs sous-thèmes, par exemple le thème "Education-Justice Sociale" qui regroupe l'éducation alimentaire, la sensibilisation au gaspillage alimentaire ainsi que la précarité. Cependant, ce sont les thèmes les purs et interprétables que nous avons pu obtenir. 
Aussi, le nombre de mots par thèmes varie.

Ensuite, nous avons voulu passer de nos topics fortifiés à la composition de chacun de nos PAT vu à travers ces topics. 

Nous avons opté pour la construction d'une table de comptage, basée sur les termes fortifiés et nous avons compté l'occurence de chaque terme dans chaque description lemmatisée. Nous avons ensuite construit une matrice de fréquence à partir de cette table de comptage. Sur cette table de comptage, nous avons réalisé une CAH après AFC (par deux méthodologies distinctes, que nous avons aussi tenté de comparer).  

Nous avons utilisé un LLM pour analyser la cohérence et la qualité de notre approche. 

En analysant les PAT les purs de chaque topic, c'est plutôt cohérent et nous sommes confiants de la qualité de nos topics fortifiés. 

En conclusion, nous avons demander à un LLM de partir de nos descriptions lemmatisées (sans aucune connaissance a priori des thèmes), de les identifier, et de les quantifier et d'aller jusqu'à la classification des PAT selon leur composition en thèmes. Nous pouvons en conclure que le LLM fait mieux, mais nos topics fortifiés sont très cohérents et solides (et comparables à ceux obtenus par cette approche) vis à vis de la méthodologie que nous avons mis en place. 

Cependant, nous pensons que la méthodologie pour l'obtention des profils (fréquences) des PAT est une approche trop simpliste qui est à renforcer. Nous pourrions essayer d'associer chacun de nos lemmes (qui n'appartiennent à des formes fortes) à nos topics, avec un LLM, afin de renforcer notre confiance dans les profils construits. 




