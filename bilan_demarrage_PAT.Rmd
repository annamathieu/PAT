---
title: "Bilan de Démarrage du Projet PAT"
author: "Erwan Gouhier, Anna Mathieu"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    number_sections: true
    toc_float: true
    self_contained: true
    df_print: paged
    highlight: tango
    tabset: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

```{r packages, include=F}
library(tidyverse)
library(tidyr)
library(dplyr)
library(ggplot2)
library(stringr)
library(stringr) # faire des comptages 
library(utils)
```


# Introduction

La définition légale des PAT est inscrite dans [les articles L.1 et L. 111-2-2 du code rural et de la pêche maritime](https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000043978779#:~:text=Version%20en%20vigueur%20depuis%20le%2025%20ao%C3%BBt%202021,-Modifi%C3%A9%20par%20LOI&text=Les%20projets%20alimentaires%20territoriaux%20mentionn%C3%A9s,d'un%20syst%C3%A8me%20alimentaire%20territorial.) (CRPM), dans la version en vigueur depuis le 25-08-2021.

Les PAT sont des projets portés par des entités territoriales diverses (EPCI, départements ou régions en coopération, entreprises ...) avec comme objectif de fédérer les acteurs du territoire autour de la question de l’alimentation. Ce sujet est abordé selon plusieurs axes: sociaux, environnementaux, économiques et de santé.

Les PAT naissent d’une démarche volontaire et collective des territoires, chaque année un appel à candidature a lieu, les territoires doivent alors remplir un formulaire en indiquant leurs caractéristiques (démographie, SAU …) et en indiquant les thématiques abordées par leur PAT ainsi que les actions qu’ils souhaitent entreprendre.

La cadre législatif des PAT a été posé en 2014, les premiers PAT ont été déployés entre 2016 et 2017. Après la crise du COVID-19, le déploiement de PAT a été accéléré avec la création d’un réseau national des PAT porté sous la Loi Climat et Résilience.

Il existe différents niveaux de reconnaissance des PAT. Les PAT de niveau 1, dit “émergents” obtiennent ce statut non reconductible pour une durée de 3 ans, après signature d’une convention. Cette durée doit permettre aux PAT de se conformer aux conditions de reconnaissances de niveau 2 des PAT, dit “opérationnels”, c’est-à-dire la mise en œuvre d'actions opérationnelles, systémiques possibles, pilotées par une instance de gouvernance établie, à l'aide de moyens humains et financiers associés ([Cahier des Charges, des appels à candidatures des PAT, 05 juillet 2024](https://agriculture.gouv.fr/planification-ecologique-lancement-de-lappel-candidatures-soutien-au-deploiement-des-projets) ).

En 2024, un plan de soutien aux déploiement des PAT, prévoyant un budget de 20M€, permet de proposer un soutien financier aux PAT de niveau 2, qui jusqu’à là n’en bénéficient pas, afin de soutenir et d’assurer la poursuite de la dynamique de leur animation “à la hauteur de l’ambition de leur plan d’action et de leur gouvernance”. En 2025, se sont 462 PAT qui sont soient en cours de validation, en phase d’émergence (Niveau 1) ou opérationnel (Niveau 2)

L’objectif de ce projet est d'analyser la base de données FRANCE PAT, afin de comprendre si les PAT ont des effets concrets sur les territoires et participent réellement aux enjeux de transitions alimentaires et environnementales, en répondant aux problématiques spécifiques du territoire qu’ils concernent.

# Importation données

```{r}
library(tidyverse)
pat2025 <- read.csv("data/pats-20250710-win1252.csv", header = T, sep = ";", fileEncoding = "latin1", dec = ".")
pat2025[pat2025== ""] <- NA # transformation des cases vides en NA

```

# Répartition des PAT entre niveaux 1 (émergents) et 2 (opérationnel)

```{r}
pat2025$niveaux_de_labelisation <- as.factor(pat2025$niveaux_de_labelisation)
summary(pat2025$niveaux_de_labelisation)

pat2025 %>% 
  ggplot() +
  geom_bar(aes(x=niveaux_de_labelisation,fill=niveaux_de_labelisation),col="black") +
  geom_text(
        stat = "count",
        aes(x = niveaux_de_labelisation,
            label = after_stat(count)
        ),
        position = position_dodge(),
        color = "black",
        size = 5,
        vjust = -0.2
    )+
  scale_x_discrete(labels = c("En attente","Niveau 1","Niveau 2","NA"))+
  scale_fill_discrete(palette = c("#F2C799","#F5821E","#C75318","gray"))+
  xlab("Niveau de labellisation") +
  ylab("Nombre de PAT") +
  ggtitle(label = "Repartition des PAT - Novembre 2025") +
  theme(axis.text.x = element_text(size=12,colour = "black"),
        axis.text.y = element_text(size=12,colour = "black"),
        axis.title.x =  element_text(size=14,face="bold"),
        axis.title.y =  element_text(size=14,face="bold"),
        panel.background = element_rect(fill="white"),
        legend.position = "none",
        panel.grid.major = element_line(colour = "grey85"),
        plot.title = element_text(size=16,face="bold",hjust=0.5))
```

# Quel Indicateur d'ancienneté/avancement des PAT utilisés ?

Dans la base de données, il y a deux colonnes qui peuvent être utilisées pour définir le niveau d'ancienneté des PAT : 
- "les_etapes_cles_conduites_et_realisees"	
- "niveaux_de_labelisation"

La colonnes "étapes clés conduites et réalisées fait référence aux 6 étapes d'avancement des PAT : 
  - Concertation (n°1), 
  - Stratégie du projet construite et validée (n°2), 
  - Premier plan d'action établi par une délibération (n°3), 
  - Mise en oeuvre du premier plan d'action (n°4), 
  - Second plan d'action établi par une délibération (n°5), 
  - Trois ou plus, plans d'actions établis par délibération (n°6)

=> le niveau "concertation" correspond aux projets qui ne sont pas encore de niveau 1, ils correspondent à une "labellisation en attente"

# exemple sur R (ligne 125)
```{r}
pat2025[123,c(79:80)]
```


=> Théoriquement, le niveau "Premier plan d'action établi par une délibération" devrait correspondre aux PAT de niveau au moins égal à 1, et les PAT de niveaux 2 doivent au moins satisfaire le niveau "Second plan d'action établi par une délibération". 

# exemples sur R (lignes ) et contre exemples 



# Description des PAT

```{r}
pat2025$description_presente <- ifelse(is.na(pat2025$descriptions_libre_des_enjeux_du_territoire_par_le_porteur),"Absente","Présente")

pat2025 %>% 
  ggplot() +
  geom_bar(aes(x=niveaux_de_labelisation,fill=description_presente,),
           color="black",position = "stack") +
  xlab("Niveau de labellisation") +
  ylab("Nombre de PAT")+
  ggtitle(label = "Description des PAT - Novembre 2025")+
  scale_x_discrete(labels = c("En attente","Niveau 1","Niveau 2","NA"))+
  scale_fill_discrete(name = "Description",palette = c("seashell3","tan1"))+
  theme(axis.text.x = element_text(size=12,colour = "black"),
        axis.text.y = element_text(size=12,colour = "black"),
        axis.title.x =  element_text(size=14,face="bold"),
        axis.title.y =  element_text(size=14,face="bold"),
        panel.background = element_rect(fill="white"),
        plot.title = element_text(size=16,face="bold",hjust=0.5))
```
# Engagement des PAT dans leurs thématiques
```{r}
culture_2025 <- read.csv("data/Axes/pats-axe-culturel-et-gastronomie-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")


score_engagement <- function(dta,axe){
  #On récupère les différente catégorie (elles ont au moins une réponse donc _1_est_ressource est       forcément présent pour chaque catégorie)
  
  dta[dta==""] <- NA
  
  categorie <- grepl("_1_est_ressource", colnames(dta), fixed = TRUE)
  
  #On extrait les noms des catégories
  nom_categories <- str_replace_all(colnames(dta)[categorie],"_1_est_ressource","")
  
  #Création du data frame des engagements
  dta_engagement <- data.frame(id = as.character(dta$id))
    
  for (i in 1:length(nom_categories)){
    #On extrait les sous catégories pour chaque chaque catégorie (e.g sensibilisation_enfant_1, ...enfant_2, etc. appartiennent à la catégorie sensibilisation_enfant)
    sous_categories <- grep(paste0(".*", nom_categories[i], ".*", "descriptif"), colnames(dta), value=TRUE)
    
    #Tableau pour chaque catégorie avec toutes les sous_catégories dedans
    tab_categories <- dta[sous_categories]
    
    #On définie le score d'engagement comme le nombre de descriptif, donc d'actions mises en place 
    engagement <- apply(tab_categories, MARGIN = 1,function(x) sum(!is.na(x)))
    
    #On stock le score d'engagement pour chaque catégorie
    dta_engagement[[paste(axe,nom_categories[i],"engagement",sep="_")]] <- engagement
}
return(dta_engagement)
}

#### On charge tous les axes thématiques####
economique_2025 <- read.csv("data/Axes/pats-axe-economie-alimentaire-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

education_2025 <- read.csv("data/Axes/pats-axe-education-alimentaire-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

environnement_2025 <- read.csv("data/Axes/pats-axe-environnement-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

gouvernance_2025 <- read.csv("data/Axes/pats-axe-gouvernance-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

just_sociale_2025 <- read.csv("data/Axes/pats-axe-justice-sociale-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

nutri_sante_2025 <- read.csv("data/Axes/pats-axe-nutrition-et-sante-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

resto_2025 <- read.csv("data/Axes/pats-axe-restauration-collective-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

urbanisme_2025 <- read.csv("data/Axes/pats-axe-urbanisme-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

#### On calcule les scores pour chaque axe ####

score_culturel <- score_engagement(culture_2025,axe = "culturel")
score_economique <- score_engagement(economique_2025,axe = "economique")
score_education <- score_engagement(education_2025,axe = "education")
score_environnement <- score_engagement(environnement_2025,axe = "environnement")
score_gouvernance <- score_engagement(gouvernance_2025,axe = "gouvernance")
score_justice_sociale <- score_engagement(just_sociale_2025,axe = "justice_sociale")
score_nutri_sante <- score_engagement(nutri_sante_2025,axe = "nutri_sante")
score_resto <- score_engagement(resto_2025,axe = "restauration")
score_urbanisme <- score_engagement(urbanisme_2025,axe = "urbanisme")

#### On merge tout au document qui contient les descriptions de chaque PAT ####
pat2025 <- pat2025 %>% 
  left_join(score_culturel,by="id") %>%
  left_join(score_economique,by="id") %>%
  left_join(score_education,by="id") %>%
  left_join(score_environnement,by="id") %>%
  left_join(score_gouvernance,by="id") %>%
  left_join(score_justice_sociale,by="id") %>%
  left_join(score_nutri_sante,by="id") %>%
  left_join(score_resto,by="id") %>%
  left_join(score_urbanisme,by="id")
  

```




# Repartition des PAT par ancienneté 

```{r}
# construction distribution 
sum(!is.na(pat2025$annee_de_signature_de_la_convention))/462
```
62 % des PAT n'ont pas leur année de signature de la convention indiquée. On associe cette information à l'ancienneté du PAT. 

Peut on compléter cette information en la cherchant sur le web pour les PAT pour lesquels elle manque ? 

```{r}
pat2025$annee_de_signature_de_la_convention<- as.factor(pat2025$annee_de_signature_de_la_convention)
summary(pat2025$annee_de_signature_de_la_convention)
```

Voici la répartition des PAT par année de signature. 