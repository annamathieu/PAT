---
title: "Bilan de Démarrage du Projet PAT"
author: "Erwan Gouhier, Anna Mathieu"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    number_sections: true
    toc_float: true
    self_contained: true
    df_print: paged
    highlight: tango
    tabset: true
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

```{r packages, include=F}
library(tidyverse)
library(tidyr)
library(dplyr)
library(ggplot2)
library(stringr)
library(stringr) # faire des comptages 
library(utils)
```

# Introduction

La définition légale des PAT est inscrite dans [les articles L.1 et L.
111-2-2 du code rural et de la pêche
maritime](https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000043978779#:~:text=Version%20en%20vigueur%20depuis%20le%2025%20ao%C3%BBt%202021,-Modifi%C3%A9%20par%20LOI&text=Les%20projets%20alimentaires%20territoriaux%20mentionn%C3%A9s,d'un%20syst%C3%A8me%20alimentaire%20territorial.)
(CRPM), dans la version en vigueur depuis le 25-08-2021.

Les PAT sont des projets portés par des entités territoriales diverses
(EPCI, départements ou régions en coopération, entreprises ...) avec
comme objectif de fédérer les acteurs du territoire autour de la
question de l’alimentation. Ce sujet est abordé selon plusieurs axes:
sociaux, environnementaux, économiques et de santé.

Les PAT naissent d’une démarche volontaire et collective des
territoires, chaque année un appel à candidature a lieu, les territoires
doivent alors remplir un formulaire en indiquant leurs caractéristiques
(démographie, SAU …) et en indiquant les thématiques abordées par leur
PAT ainsi que les actions qu’ils souhaitent entreprendre.

La cadre législatif des PAT a été posé en 2014, les premiers PAT ont été
déployés entre 2016 et 2017. Après la crise du COVID-19, le déploiement
de PAT a été accéléré avec la création d’un réseau national des PAT
porté sous la Loi Climat et Résilience.

Il existe différents niveaux de reconnaissance des PAT. Les PAT de
niveau 1, dit “émergents” obtiennent ce statut non reconductible pour
une durée de 3 ans, après signature d’une convention. Cette durée doit
permettre aux PAT de se conformer aux conditions de reconnaissances de
niveau 2 des PAT, dit “opérationnels”, c’est-à-dire la mise en œuvre
d'actions opérationnelles, systémiques possibles, pilotées par une
instance de gouvernance établie, à l'aide de moyens humains et
financiers associés ([Cahier des Charges, des appels à candidatures des
PAT, 05 juillet
2024](https://agriculture.gouv.fr/planification-ecologique-lancement-de-lappel-candidatures-soutien-au-deploiement-des-projets)
).

En 2024, un plan de soutien aux déploiement des PAT, prévoyant un budget
de 20M€, permet de proposer un soutien financier aux PAT de niveau 2,
qui jusqu’à là n’en bénéficient pas, afin de soutenir et d’assurer la
poursuite de la dynamique de leur animation “à la hauteur de l’ambition
de leur plan d’action et de leur gouvernance”. En 2025, se sont 462 PAT
qui sont soient en cours de validation, en phase d’émergence (Niveau 1)
ou opérationnel (Niveau 2)

L’objectif de ce projet est d'analyser la base de données FRANCE PAT,
afin de comprendre si les PAT ont des effets concrets sur les
territoires et participent réellement aux enjeux de transitions
alimentaires et environnementales, en répondant aux problématiques
spécifiques du territoire qu’ils concernent.

# Importation données

```{r}
library(tidyverse)
pat2025 <- read.csv("data/pats-20250710-win1252.csv", header = T, sep = ";", fileEncoding = "latin1", dec = ".")
pat2025[pat2025== ""] <- NA # transformation des cases vides en NA

```

# Comment sont structurées les données ?

La collecte de données a lieu deux fois par an. Nous avons accès aux
deux collectes de données des années 2024 et 2025.

Il y a un fichier Excel pour la description du PAT (2 par an sur 2 ans
=\> 4 ), et un fichier par axe thématique (il y en a 9 au total, donc a
9 \* 2 années \* 2 fichiers par an = 36 fichiers). Chaque ligne de
chaque fichier correspond à un PAT unique (= 462 lignes).

Les bases de données contiennent des variables dont nous essayerons de
comprendre l'intérêt pour la qualification des PAT.

# Répartition des PAT entre niveaux 1 (émergents) et 2 (opérationnel)

```{r}
summary(pat2025$niveaux_de_labelisation)

pat2025 %>% 
  ggplot() +
  geom_bar(aes(x=niveaux_de_labelisation,fill=niveaux_de_labelisation),col="black") +
  geom_text(
        stat = "count",
        aes(x = niveaux_de_labelisation,
            label = after_stat(count)
        ),
        position = position_dodge(),
        color = "black",
        size = 5,
        vjust = -0.2
    )+
  scale_x_discrete(labels = c("En attente","Niveau 1","Niveau 2","NA"))+
  scale_fill_discrete(palette = c("#F2C799","#F5821E","#C75318","gray"))+
  xlab("Niveau de labellisation") +
  ylab("Nombre de PAT") +
  ggtitle(label = "Repartition des PAT - Novembre 2025") +
  theme(axis.text.x = element_text(size=12,colour = "black"),
        axis.text.y = element_text(size=12,colour = "black"),
        axis.title.x =  element_text(size=14,face="bold"),
        axis.title.y =  element_text(size=14,face="bold"),
        panel.background = element_rect(fill="white"),
        legend.position = "none",
        panel.grid.major = element_line(colour = "grey85"),
        plot.title = element_text(size=16,face="bold",hjust=0.5))
```

# Quel Indicateur d'ancienneté/avancement des PAT utilisés ?

Dans la base de données, il y a deux colonnes qui peuvent être utilisées
pour définir le niveau d'ancienneté des PAT : -
"les_etapes_cles_conduites_et_realisees"\
- "niveaux_de_labelisation"

La colonnes "étapes clés conduites et réalisées fait référence aux 6
étapes d'avancement des PAT : - Concertation (n°1), - Stratégie du
projet construite et validée (n°2), - Premier plan d'action établi par
une délibération (n°3), - Mise en oeuvre du premier plan d'action
(n°4), - Second plan d'action établi par une délibération (n°5), - Trois
ou plus, plans d'actions établis par délibération (n°6)

=\> le niveau "concertation" devrat correspond aux projets "en attente",
pourtant on peut voir qu'un correspond à une "labellisation niveau 1".

# exemple sur R (ligne 125)

```{r}
pat2025[123,c(79:80)]
```

=\> Théoriquement, le niveau "Premier plan d'action établi par une
délibération" devrait correspondre aux PAT de niveau au moins égal à 1,
et les PAT de niveaux 2 doivent au moins satisfaire le niveau "Second
plan d'action établi par une délibération".

# exemples sur R (lignes ) et contre exemples

```{r}

```

On voulait réaliser un graphique de la distribution des PAT selon leur
dernière étape d'avancement réalisée, en fonction de leur niveau, afin
de voir à quelles étapes se situent les PAT de niveau 1 et de niveau 2.

```{r}
n_et_e<- as.data.frame(cbind(niveau = pat2025$niveaux_de_labelisation, 
                             steps = pat2025$les_etapes_cles_conduites_et_realisees ))

summary(n_et_e)

  trans_etapes <- function(etapes){
  
  for (j in 1:length(etapes)){
    if (is.na(etapes[j])) {
      etapes[j] <- ""
      next
    }
    
    virg <- str_count(string = etapes[j], pattern = ",") # compte le nombre de virgules => virg + 1 = nombre d'étapes 
    etapes[j] <- str_split_i(string = etapes[j], pattern= ", ", i = virg+1) # couper un espace après la virgule et garder le dernier élément (de num virg + 1)
    # conserve la dernière étape
  
    if (etapes[j]=="plans d'actions établis par délibération"){
     etapes[j]<- "Trois ou plus, plans d'actions établis par délibération"
    } 
  }
  # Transformation en nombre
  etapes <- case_when(
    etapes == "Concertation" ~ 1,
         etapes == "Stratégie du projet construite et validée" ~ 2,
         etapes == "Premier plan d'action établi par une délibération" ~ 3,
         etapes == "Mise en oeuvre du premier plan d'action" ~ 4,
         etapes == "Second plan d'action établi par une délibération" ~ 5,
         etapes == "Trois ou plus, plans d'actions établis par délibération" ~ 6,
         etapes == "" ~ NA
  )
  return(etapes)
}

n_et_e$steps <- trans_etapes(n_et_e$steps)
n_et_e$niveau[is.na(n_et_e$niveau)] <- "NA"


n_et_e %>% ggplot() +
  aes(x = steps, group = niveau, fill = niveau) +
  geom_bar(col="black") +
  scale_fill_manual(values = c("#F2C799","#F0921E","#C75318","grey")) +
  labs(fill = "Niveau du PAT")+
  ylab("Nombre de PAT") +
  xlab("Avancement du PAT") +
  scale_x_discrete(labels = c(
    "Concertation",
    "Stratégie construite",
    "Premier plan d'action établi",
    "Mise en oeuvre 1er plan",
    "Second plan d'action établi","≥3 plans établis"
  ))+
  ggtitle(label = "Etape d'avancement la plus avancée réalisée par PAT selon leur niveau - Novembre 2025")+
  theme(panel.background = element_rect(fill="white"),
        plot.title = element_text(face="bold",hjust=0.2,size=15), 
        axis.title.x = element_text(size=14,face="bold"),
        axis.title.y = element_text(size=14,face="bold"),
        panel.grid.major = element_line(colour = "grey85"),
        axis.ticks.x = element_blank(),
        axis.text.x = element_text(vjust=0.65,angle=50,size=12,colour="black"))

```

# Quelles sont les variables les plus importantes ? Pourquoi chaque variable a -t-elle été enregistrée ?

On a cherché à comprendre au sein du fichier de description des PAT,
pourquoi chacune des variables a été demandée dans le questionnaire

On a : - étudié les taux de NA pour chaque variable - cherché à
comprendre quelles variables pourraient être sélectionnées comme
variables illustratives pour qualifier nos PAT - chercher à comprendre
quelle dimension de variabilité se cache derrière chacune de ces
variables sélectionnées.

La liste des variables du fichier "description" se trouve dans le
fichier "modele de données" dans la base France PAT. Ce fichier n'est
pas à jour, les variables ayant évolué depuis 2024.

Voici les variables qui manquaient : Nombre de communes du territoires
Sau en hectare Pourcentage_de_la_surface_des_prairies_permanentes
Pourcentage_de_la_surface_des_cultures_de_legumineuses
metres_de_haie_par_hectare_de_sau
Microgrammes_de_produits_phytopharmaceutiques_par_litre_deau
Milligrammes_de_nitrates_par_litre_deau M3_deau_utilise_pour_lirragation
Evolution_de_lirrigation_depuis_5_ans Metres_de_haie_par_hectare_de_sau
Nombre_denseignes_de_distribution
Nombre_denseignes_de_distribution_de_gms
Nombre_demplois_dans_la_transformation nombre_de_cantines_inscrites
Evolution_du_nombre_demplois_dans_la_transformation_entre_2018_et_2023
Nombre_de_restaurants_collectifs_sur_le_territoire_qui_ont_fait_leur_teledeclaration_sur_ma_cantine
nombre_dassociations_luttant_contre_la_precarite_alimentaire
nombre_dassociations_luttant_contre_la_precarite_alimentaire_par_10km2
nombre_dassociations_luttant_contre_la_precarite_alimentaire_par_1000habitants

Taux de NA

```{r}
library(VIM)
NA_graph <- aggr(x=pat2025,numbers=T,sortVar=F, plot= F) 
res.na <- NA_graph$count
```

# Description des PAT

La colonne "description_libre_des_enjeux_par_le_porteur" est une
variable très intéressante, dans laquelle le porteur de projet résume
les enjeux de ce projet alimentaire pour son territoire. Cette donnée
textuelle caractérise donc les PAT. Elle porte un facteur de variabilité
individuelle puisque les PAT sont décrits par leur porteur de projet.

Cette donnée sera mise en lien avec d'autres données textuelles,
notamment les variables "objectifs_strategiques" afin de comprendre en
quelles proportions les enjeux développés sont traduits ensuites en
objectifs dans le PAT.

On s'est demandés combien de PAT n'avaient pas de description. On s'est
ensuite demandés combien de PAT n'avaient pas de description selon leur
niveau de labellisation.

```{r}
pat2025$description_presente <- ifelse(is.na(pat2025$descriptions_libre_des_enjeux_du_territoire_par_le_porteur),"Absente","Présente")

pat2025 %>% 
  ggplot() +
  geom_bar(aes(x=niveaux_de_labelisation,fill=description_presente,),
           color="black",position = "stack") +
  xlab("Niveau de labellisation") +
  ylab("Nombre de PAT")+
  ggtitle(label = "Description des PAT - Novembre 2025")+
  scale_x_discrete(labels = c("En attente","Niveau 1","Niveau 2","NA"))+
  scale_fill_discrete(name = "Description",palette = c("seashell3","tan1"))+
  theme(axis.text.x = element_text(size=12,colour = "black"),
        axis.text.y = element_text(size=12,colour = "black"),
        axis.title.x =  element_text(size=14,face="bold"),
        axis.title.y =  element_text(size=14,face="bold"),
        panel.background = element_rect(fill="white"),
        plot.title = element_text(size=16,face="bold",hjust=0.5))
```

# Engagement des PAT dans leurs thématiques

Chaque PAT décide de s'impliquer ou non dans chaque axe thématique et
chaque axe thématique est défini par un certain nombre d'actions. Il y a
au total 44 actions identifiés sur tous les axes thématiques.

Chaque PAT réalise entre 0 et 5 actions pour chaque action de chaque axe
thématique.

On a cherché à comprendre sur quels axes thématiques chaque PAT est le
plus impliqué en comptant le nombre d'actions mis en place par chaque
PAT (en 2025 sur la déclaration de novembre) pour chaque action de
chaque axe thématique.

```{r}
culture_2025 <- read.csv("data/Axes/pats-axe-culturel-et-gastronomie-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")


score_engagement <- function(dta,axe){
  #On récupère les différente catégorie (elles ont au moins une réponse donc _1_est_ressource est       forcément présent pour chaque catégorie)
  
  dta[dta==""] <- NA
  
  categorie <- grepl("_1_est_ressource", colnames(dta), fixed = TRUE)
  
  #On extrait les noms des catégories
  nom_categories <- str_replace_all(colnames(dta)[categorie],"_1_est_ressource","")
  
  #Création du data frame des engagements
  dta_engagement <- data.frame(id = as.character(dta$id))
    
  for (i in 1:length(nom_categories)){
    #On extrait les sous catégories pour chaque chaque catégorie (e.g sensibilisation_enfant_1, ...enfant_2, etc. appartiennent à la catégorie sensibilisation_enfant)
    sous_categories <- grep(paste0(".*", nom_categories[i], ".*", "descriptif"), colnames(dta), value=TRUE)
    
    #Tableau pour chaque catégorie avec toutes les sous_catégories dedans
    tab_categories <- dta[sous_categories]
    
    #On définie le score d'engagement comme le nombre de descriptif, donc d'actions mises en place 
    engagement <- apply(tab_categories, MARGIN = 1,function(x) sum(!is.na(x)))
    
    #On stock le score d'engagement pour chaque catégorie
    dta_engagement[[paste(axe,nom_categories[i],"engagement",sep="_")]] <- engagement
}
return(dta_engagement)
}

#### On charge tous les axes thématiques####
economique_2025 <- read.csv("data/Axes/pats-axe-economie-alimentaire-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

education_2025 <- read.csv("data/Axes/pats-axe-education-alimentaire-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

environnement_2025 <- read.csv("data/Axes/pats-axe-environnement-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

gouvernance_2025 <- read.csv("data/Axes/pats-axe-gouvernance-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

just_sociale_2025 <- read.csv("data/Axes/pats-axe-justice-sociale-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

nutri_sante_2025 <- read.csv("data/Axes/pats-axe-nutrition-et-sante-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

resto_2025 <- read.csv("data/Axes/pats-axe-restauration-collective-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

urbanisme_2025 <- read.csv("data/Axes/pats-axe-urbanisme-20250710-win1252.csv", header=TRUE, sep = ";", fileEncoding = "latin1", dec = ".")

#### On calcule les scores pour chaque axe ####

score_culturel <- score_engagement(culture_2025,axe = "culturel")
score_economique <- score_engagement(economique_2025,axe = "economique")
score_education <- score_engagement(education_2025,axe = "education")
score_environnement <- score_engagement(environnement_2025,axe = "environnement")
score_gouvernance <- score_engagement(gouvernance_2025,axe = "gouvernance")
score_justice_sociale <- score_engagement(just_sociale_2025,axe = "justice_sociale")
score_nutri_sante <- score_engagement(nutri_sante_2025,axe = "nutri_sante")
score_resto <- score_engagement(resto_2025,axe = "restauration")
score_urbanisme <- score_engagement(urbanisme_2025,axe = "urbanisme")

#### On merge tout au document qui contient les descriptions de chaque PAT ####
pat2025 <- pat2025 %>% 
  left_join(score_culturel,by="id") %>%
  left_join(score_economique,by="id") %>%
  left_join(score_education,by="id") %>%
  left_join(score_environnement,by="id") %>%
  left_join(score_gouvernance,by="id") %>%
  left_join(score_justice_sociale,by="id") %>%
  left_join(score_nutri_sante,by="id") %>%
  left_join(score_resto,by="id") %>%
  left_join(score_urbanisme,by="id")
  

```

# Repartition des PAT par ancienneté

```{r}
# construction distribution 
sum(!is.na(pat2025$annee_de_signature_de_la_convention))/462
```

62 % des PAT n'ont pas leur année de signature de la convention
indiquée. On associe cette information à l'ancienneté du PAT.

Peut on compléter cette information en la cherchant sur le web pour les
PAT pour lesquels elle manque ?

```{r}
pat2025$annee_de_signature_de_la_convention<- as.factor(pat2025$annee_de_signature_de_la_convention)
summary(pat2025$annee_de_signature_de_la_convention)
```

Voici la répartition des PAT par année de signature. On s'est demandé si
elle était représentative du nombre de nouveaux PAT signés chaque année.
